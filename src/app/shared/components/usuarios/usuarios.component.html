<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h4 class="d-flex justify-content-center">Usuarios</h4>
        <hr>

        <div class="row">
          <div class="col-12">
            <div class="d-flex justify-content-start">
              <button type="button" class="btn btn-outline-success btn-rounded btn-sm mr-2" (click)="clearNew()"
                data-toggle="modal" data-target="#modalNuevoUser"><i class="icon-plus"></i>Nuevo</button>

            </div>
          </div>
        </div>

        <div class="row pt-2">
          <div class="col-12 table-responsive1">

            <ag-grid-angular #Grid style="width: 100%; height: 100%;" class="ag-theme-alpine"
            [columnDefs]="columnDefs"
              [defaultColDef]="defaultColDef"
              [rowData]="usuarios"
              [suppressMenuHide]="true"
              [pagination]="true"
              [groupSelectsChildren]="true"
              [enableCellChangeFlash]="true"
               [suppressMaxRenderedRowRestriction]="true"
              [overlayLoadingTemplate]="overlayLoadingTemplate"
              [overlayNoRowsTemplate]="overlayNoRowsTemplate"
              [localeText]="localeText"
             ></ag-grid-angular>


          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Modal nuevo usuario-->
<div class="modal fade" id="modalNuevoUser" tabindex="-1" role="dialog" aria-labelledby="modalNuevoUserLabel"
  aria-hidden="true">
  <div class="modal-dialog " role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalNuevoUserLabel">Nuevo usuario</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form [formGroup]="userForm">
          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Nombre</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="usuario" type="text" placeholder="Nombre de ejemplo"
                formControlName="usuario">
            </div>
          </div>
          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Usuario</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="nombre" type="text" placeholder="Inarco" formControlName="nombre">
            </div>


          </div>
          <div>

            <div class="form-group row">
              <div class="col-lg-3">
                <label class="col-form-label">Contraseña</label>
              </div>
              <div class="col-lg-8">
                <input class="form-control" name="pass" type="password" placeholder="****" formControlName="pass">

              </div>


            </div>
            <div class="form-group row">
              <div class="col-lg-3">
                <label class="col-form-label">Repetir contraseña</label>
              </div>
              <div class="col-lg-8">
                <input class="form-control" name="confirmPass" type="password" placeholder="****"
                  formControlName="confirmPassword">

                <small *ngIf="userForm.hasError('notSame')" class="text-danger">
                  Las contraseñas no coinciden
                </small>

              </div>


            </div>
          </div>



          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Mail</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="email" type="email" placeholder="ejemplo@inarco.cl"
                formControlName="mail">
            </div>
          </div>

          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Estado</label>
            </div>
            <div class="col-lg-8">
              <select class="form-control" formControlName="estado" name="estado">
                <option value="Activo">Activo</option>
                <option value="Inactivo">Inactivo</option>
              </select>

            </div>
          </div>

          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Firma</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="firma" type="file"
                formControlName="firma">
            </div>
          </div>


        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="crearUsuario()"
          [disabled]="!userForm.valid">Grabar</button>
        <button type="button" class="btn btn-light" data-dismiss="modal" #closeModal>Cancelar</button>
      </div>
    </div>
  </div>
</div>

<!--Modal editar usuario-->
<div class="modal fade" id="modalEditUser" tabindex="-1" role="dialog" aria-labelledby="modalNuevoUserLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalNuevoUserLabel">{{titleModal}} usuario {{userTitleEditModal}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form [formGroup]="userForm">
          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Nombre</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="usuario" type="text" placeholder="Nombre de ejemplo"
                formControlName="usuario" readonly>
            </div>
          </div>
          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Usuario</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="nombre" type="text" placeholder="Inarco" formControlName="nombre"
                readonly>
            </div>


          </div>


          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Mail</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="email" type="email" placeholder="ejemplo@inarco.cl"
                formControlName="mail">
            </div>
          </div>

          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Estado</label>
            </div>
            <div class="col-lg-8">
              <select class="form-control" formControlName="estado" name="estado">
                <option value="Activo">Activo</option>
                <option value="Inactivo">Inactivo</option>
              </select>

            </div>
          </div>
          <div class="form-group row">
            <div class="col-lg-3">
              <label class="col-form-label">Firma</label>
            </div>
            <div class="col-lg-8">
              <input class="form-control" name="firma" type="file"
                formControlName="firma">
            </div>
          </div>


        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="saveEditUser()"
          [disabled]="!userForm.valid">Grabar</button>
        <button type="button" class="btn btn-light" data-dismiss="modal" #closeModalEdit>Cancelar</button>
      </div>
    </div>
  </div>
</div>


<!--Modal Asociar obras-->
<div class="modal fade" id="modalAsociarObras" tabindex="-1" role="dialog" aria-labelledby="modalAsociarObrasLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalAsociarObrasLabel">Asociar obras al usuario {{userSelect.nombre_usuario}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" #closeModalAsociar>
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="obrasAsociar.length>0">
        <div class="row">
          <div class="col-12">
            <input type="checkbox" class="mr-2"  (change)="toggleAll($event)" [checked]="allSelected"> <label
            class="form-title">Seleccionar todos</label>
          </div>
        </div>
        <div class="row" >
          <div class="col-md-4" *ngFor="let item of obrasAsociar">
            <div style="border: 1px solid #ccc!important;padding : 5px 10px">
              <input type="checkbox" class="mr-2" [(ngModel)]="item.isCheck" [checked]="item.isCheck"> <label
              class="form-title">{{item.codigo}} | {{item.nombre}} </label>

            </div>

          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="guardarObraAsociada()"
          [disabled]="obrasAsociar.length==0">Grabar</button>
        <button type="button" class="btn btn-light" data-dismiss="modal" #closeModalEdit>Cancelar</button>
      </div>
    </div>
  </div>
</div>
